<h1>All Transactions</h1>
<div class="filters">
    <div class="search-bar">
        <span class="material-symbols-outlined" aria-hidden="true">
            search
        </span>
        <input 
            type="text" 
            placeholder="Search Transactions..."
            aria-label="Search Transactions"
            [value]="searchTerm()"
            (input)="searchTerm.set($any($event.target).value)"
        >
    </div>
    <select 
        class="types" 
        aria-label="Filter by transaction type"
        [value]="selectedType() ?? 0"
        (change)="onChangeType($event)"
    >
        @for(type of transactionTypeOptions; track $index) {
            <option [value]="$index">{{ type }}</option>
        }
    </select>
    <div class="categories">
        <button 
            class="category-header" 
            aria-label="Filter by categories"
            (click)="toggleModal('category')"
        >
            <p>Categories</p>
            <span class="material-symbols-outlined">
                keyboard_arrow_down
            </span>
        </button>
        <div class="category-modal" [class.open]="modals().category">
            @for (c of categories(); track c.categoryId) {
                <label class="category-option">
                    <input
                        type="checkbox"
                        [value]="c.name"
                        [checked]="selectedCategories().includes(c.name)"
                        (change)="onCategoryToggle(c.name, $event.target.checked)"
                    />
                    {{ c.name }}
                </label>
            }
        </div>
    </div>
    <select 
        class="payment-methods" 
        aria-label="Filter by payment method"
        [value]="selectedPaymentType() ?? 0"
        (change)="onChangePaymentType($event)"
    >
        @for(type of paymentTypeOptions; track $index) {
            <option [value]="$index">{{ type }}</option>
        }
    </select>
    <div class="amount">
        <button class="amount-header" (click)="toggleModal('amount')" aria-label="Filter by amount range">
            <p>Amount</p>
            @if(minAmount() === null || maxAmount() === null) {
                <span class="material-symbols-outlined">
                    keyboard_arrow_down
                </span>
            }
            @if(minAmount() !== null && maxAmount() !== null) {
                <div>
                    ${{ minAmount() }} - ${{ maxAmount() }} 
                </div>
                <span 
                    class="material-symbols-outlined close" 
                    role="button"
                    (click)="clearAmountFilter()">
                    close
                </span>
            }
        </button>
        <div 
            class="amount-modal" 
            [class.open]="modals().amount" 
            role="dialog"
            aria-label="Amount filter options"
            [attr.aria-hidden]="!modals().amount"]
        >
            <div class="inputs">
                <p>
                    <label for="min-amount">Min Amount</label>
                    <input 
                        type="number" 
                        placeholder="Min Amount"
                        aria-label="Minimum amount"
                        [value]="minAmount()"
                        (input)="minAmount.set($event.target.valueAsNumber || null)">
                </p>
                <p>
                    <label for="max-amount">Max Amount</label>
                    <input 
                        type="number" 
                        placeholder="Max Amount"
                        aria-label="Maximum amount"
                        [value]="maxAmount()"
                        (input)="maxAmount.set($event.target.valueAsNumber || null)">
                </p>
            </div>
        </div>
    </div>
    <div class="date">
        <button 
            class="date-header" 
            (click)="toggleModal('date')"
            [attr.aria-expanded]="modals().date"
            aria-controls="date-modal"
            aria-label="Filter by date range"
        >
            @if(startDate() === null || endDate() === null) {
                <span class="material-symbols-outlined">
                    calendar_today
                </span>
            }
            <p>Date</p>
            @if(startDate() !== null && endDate() !== null) {
                <div>
                    {{ startDate() }} - {{ endDate() }}
                </div>
                <span 
                    class="material-symbols-outlined close" 
                    role="button"
                    (click)="clearDateFilter()">
                    close
                </span>
            }
        </button>
        <div 
            class="date-modal" 
            role="dialog"
            aria-label="Date filter options"
            [class.open]="modals().date"
            [attr.aria-hidden]="!modals().date"
        >
            <div class="inputs">
                <p>
                    <label for="start-date">Start Date</label>
                    <input 
                        type="date" 
                        placeholder="From"
                        aria-label="Start date"
                        [value]="startDate()"
                        (input)="startDate.set(formatDate($event || null))">
                </p>
                <p>
                    <label for="end-date">End Date</label>
                    <input 
                        type="date" 
                        placeholder="To"
                        aria-label="End date"
                        [value]="endDate()"
                        (input)="endDate.set(formatDate($event || null))">
                </p>
            </div>
        </div>
    </div>
    @if(hasActiveFilters()) {
        <button type="button" (click)="clearFilter()" class="clear">
            <span class="material-symbols-outlined">
                close
            </span>
            Clear Filters
        </button>
    }
</div>
<table>
    <thead>
        <tr>
            <th>DATE</th>
            <th>TYPE</th>
            <th>CATEGORY</th>
            <th>TRANSACTION</th>
            <th>PAYMENT METHOD</th>
            <th>AMOUNT</th>
            <th>&nbsp;</th>
        </tr>
    </thead>
    <tbody>
        @for(t of transactions(); track t.transactionId) {
            <tr>
                <td>
                    <p>{{ t.transactionDate }}</p>
                </td>
                <td>
                    <p>{{ TransactionTypeMap[t.transactionType] }}</p>
                </td>
                <td>
                    <p>{{ categoryMap().get(t.categoryId) ?? 'Unknown' }}</p>
                </td>
                <td>
                    <p>{{ t.name }}</p>
                </td>
                <td>
                    <p>{{ PaymentTypeMap[t.paymentType] }}</p>
                </td>
                <td>
                    <p 
                        [style.color]="t.transactionType === 1 ? 'green' : 'red'"
                    >
                        {{ t.transactionType == 1 ? '+' : '-'}}{{ t.amount | currency }}
                    </p>
                </td>
                <td>
                    <div class="buttons">
                        <button (click)="onDelete(t.transactionId)">
                            <span class="material-symbols-outlined">
                                delete
                            </span>
                        </button>
                        <button (click)="onEdit(t.transactionId)">
                            <span class="material-symbols-outlined">
                                edit
                            </span>
                        </button>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>